(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1215:function(e,t,n){"use strict";n.d(t,"a",(function(){return kn}));var r=n(7),a=n(8),c=n(9),o=n(10),i=n(5),s=n(0),l=n(1),u=n.n(l),d=n(2),p=n.n(d),f=n(49),h=n(11),b=n(1054),m=n(13),v=n(527),g=n(231),O=n(526),j=n(37);function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var M=function(e){Object(c.a)(n,e);var t=y(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).handleReceiveMessage=function(t){var n=e.props;(0,n.handleReceiveMessage)(t,n.currentUser.id)},e}return Object(a.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.currentUser,n=e.setChatMqttStatus,r=e.isChatMqttExisted;t&&"guest"!==t.userType&&(r||(Object(v.a)([{name:"zhihu/message/v1/im/user/".concat(t.id,"/"),onMessage:this.handleReceiveMessage}]),n(!0)))}},{key:"render",value:function(){var e=this.props.children;return Object(s.b)("div",{children:e})}}]),n}(l.Component);var x=Object(m.connect)((function(e){return{currentUser:Object(j.b)(e),isChatMqttExisted:e.chat.global.isChatMqttExisted}}),{handleReceiveMessage:g.k,setChatMqttStatus:O.b})(M),k=n(6),C=n.n(k),w=n(22),R=n(139),E=n(96),S=n(525),T=n(20),I=n(35),N=n(356),B=n(113),z="3d198a56310c02c4a83efb9f4a4c027e",D=["https://www.zhihu.com/staffService/"+z];var A=Object(l.createContext)({showModal:!1,setShowModal:function(){return null}});function P(e){var t=e.item,n=e.selected,r=e.onClick,a=Object(I.b)((function(){return r(t)}));return Object(s.b)(h.c,{label:t.name,color:n?h.a.Blue:h.a.Grey,preset:h.b.Secondary,css:{marginRight:"8px"},onClick:a},t.id)}function U(e){var t=e.senderId,n=e.showModal,r=e.onClose,a=Object(l.useState)([]),c=Object(T.a)(a,2),o=c[0],i=c[1],u=Object(l.useState)(null),d=Object(T.a)(u,2),p=d[0],h=d[1],b=Object(m.useDispatch)(),v=Object(N.b)();Object(l.useEffect)((function(){n&&v("/api/v4/customer_service/question_tag",{ignoreCode:!0}).then((function(e){var t;i((null===(t=e.payload)||void 0===t?void 0:t.data)||[])})).catch((function(){return null}))}),[n,v]);var O=Object(I.b)(Object(I.a)((function(e){v("/api/v4/customer_service/choose_question_tag",{method:"POST",body:{adminId:z,tagId:e.id},ignoreCode:!0}).catch((function(){return null})),b(Object(g.o)({contentType:B.a.text,receiverId:t,data:{text:e.name}})),r(),h(null)}),300)),j=Object(I.b)((function(e){h(e.id),O(e)}));return Object(s.b)(f.b,{css:{width:"694px",".Modal-content":{padding:"0 0 55px 0",marginTop:0}},onClose:r,children:n&&Object(s.c)(s.a,{children:[Object(s.b)("div",{css:function(e){return{padding:"12px 0 10px 20px",fontSize:"20px",lineHeight:"28px",borderBottom:"1px solid "+e.colors.GBK09A,color:e.colors.GBK02A}},children:"选个问题类型，小管家为你解答"}),o.map((function(e){return Object(s.c)(l.Fragment,{children:[Object(s.b)("div",{css:function(e){return{marginTop:"20px",paddingLeft:"20px",fontSize:"15px",lineHeight:"18px",color:e.colors.GBK03A}},children:e.categoryName}),Object(s.b)("div",{css:{marginTop:"16px",paddingLeft:"20px"},children:e.items.map((function(e){return Object(s.b)(P,{item:e,selected:p===e.id,onClick:j},e.id)}))})]},e.categoryId)}))]})})}var _=n(4),H=n(1112),L=n(63),K=n(203),F=n(32),q=n(238),V=n(18),G=n(41),W=n(42),J=n(109),Q=n.n(J),Z=n(87),X=function(e){return/^\w+:\/\//.test(e)?e:location.origin+e},$=function(e,t){var n=t.params,r=t.onRequestOpen,a=Object(Z.b)();return function(t){var c=e.href,o=e.onClick;if(o&&o(t),!t.defaultPrevented){var i=function(e,t){if(!t)return e;var n=e.split("#"),r=Object(T.a)(n,2),a=r[0],c=r[1],o=a+(a.includes("?")?"&":"?")+t;return c?o+"#"+c:o}(X(c),n);return a.ZhihuHybrid?(t.preventDefault(),void G.a.dispatch("base/openURL",{url:i})):a.isMiniProgram?(t.preventDefault(),void function(e,t){var n,r=function(){var n,r,a,c=null,o=null;if(t.WxMiniProgram)c=null===(r=window.wx)||void 0===r||null===(a=r.miniProgram)||void 0===a?void 0:a.navigateTo;else if(t.JDMiniProgram){var i,s;c=null===(i=window.jd)||void 0===i||null===(s=i.miniProgram)||void 0===s?void 0:s.navigateTo}var l,u=null===(n=/\/topic\/(\d+)/.exec(e))||void 0===n?void 0:n[1];(u&&(t.WxMiniProgram?o="/pages/topic?id=".concat(u):t.JDMiniProgram&&(o="/pages/topic/index?id=".concat(u))),o)?null===(l=c)||void 0===l||l({url:o}):/^http(s)?:/.test(e)&&(location.href=e)};!t.WxMiniProgram||(null===(n=window.WeixinJSBridge)||void 0===n?void 0:n.invoke)?r():document.addEventListener("WeixinJSBridgeReady",r,!1)}(i,a)):void((null==r?void 0:r({ua:a,url:i}))&&t.preventDefault())}}},Y=function(e,t){var n=t.extra;return{zaType:"Button",zaAction:"OpenUrl",zaEventType:"Click",shouldTrackClick:!0,extra:Q()({link:{get url(){return X(e)}}},n)}},ee=Object(l.forwardRef)((function(e,t){var n=e.params,r=e.onRequestOpen,a=e.extra,c=Object(F.a)(e,["params","onRequestOpen","extra"]);return Object(s.b)(W.c,Object.assign({as:V.Link},Y(c.href,{extra:a}),c,{ref:t,onClick:$(c,{params:n,onRequestOpen:r})}))})),te=n(166),ne=n.n(te),re=n(55),ae=ne()(re.findImageSpec),ce=function(e,t){return Object(re.imgUrl)(e,ae(t))},oe=function(e){var t=e.user,n=e.size,r=void 0===n?38:n,a=e.noBadge,c=void 0!==a&&a,o=e.noLink,i=void 0!==o&&o,l=e.linkProps,u=Object(F.a)(e,["user","size","noBadge","noLink","linkProps"]),d=t.avatarUrl,p=t.isOrg,f=t.urlToken,h=!i&&f?"https://www.zhihu.com/".concat(p?"org":"people","/").concat(f):null,b=Object(s.b)(V.Image,{loading:"lazy",src:ce(d,r),srcSet:"".concat(ce(d,2*r)," 2x"),size:r,display:"block",css:{borderRadius:"50%"}});return Object(s.c)(V.Box,Object.assign({display:"inline-block",size:r,css:{position:"relative"}},u,{children:[h?Object(s.b)(ee,Object.assign({href:h,target:"_blank"},l,{children:b})):b,!c&&Object(s.b)(q.c,{css:Object(q.e)(r),isOrg:p,badge:t.badgeV2||t.badge,linkify:!i,enableTooltip:!0})]}))},ie=n(538),se=n(181),le=n(52),ue=n(120),de=n(33);function pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var fe=function(e){Object(c.a)(n,e);var t=pe(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this)).handleShieldUser=e.handleShieldUser.bind(Object(le.a)(e)),e}return Object(a.a)(n,[{key:"handleShieldUser",value:function(){var e=this.props,t=e.dispatch,n=e.user.urlToken,r=e.onClose;t(Object(ue.h)(n,!0)).then((function(){return t(Object(de.g)("屏蔽成功"))})),r()}},{key:"render",value:function(){var e=this.props,t=e.onClose,n=e.shown,r=e.user;return Object(s.b)(f.b,{onClose:t,title:"确定要屏蔽".concat(r.name,"？"),children:n&&Object(s.c)("div",{children:["屏蔽后，对方将不能关注你、向你发私信、评论你的实名回答、使用「@」提及你、邀请你回答问题，但仍然可以查看你的公开信息。",Object(s.c)(f.a,{direction:"horizontal",children:[Object(s.b)(h.c,{onClick:t,color:"grey",children:"取消"}),Object(s.b)(h.c,{preset:"primary",color:"blue",onClick:this.handleShieldUser,children:"确定"})]})]})})}}]),n}(l.Component),he=Object(m.connect)()(fe),be=n(521),me=n(12),ve=function(e){var t=e.message,n=Object(l.useRef)(),r=Object(l.useState)(!1),a=Object(T.a)(r,2),c=a[0],o=a[1];return Object(s.b)(V.Text,{ref:n,color:c?"inherit":"primary",css:{cursor:c?"text":"pointer"},onClick:function(){c||(o(!0),me.a.trackEvent(n.current,{action:"Click",id:6880}))},dangerouslySetInnerHTML:{__html:c?t.richText||t.text:t.extraContent}})};var ge=function(e){var t=e.message,n=e.senderId,r=e.sendMessage,a=Object(I.b)((function(e){if("A"===e.target.tagName&&e.target.href){var t=e.target.href,a=Object(be.parse)(t.split("?")[1]).message,c=t.match(/www.zhihu.com\/inbox\/([\d\w]+)/);(null==c?void 0:c[1])&&n===c[1]&&(e.preventDefault(),r({contentType:B.a.text,receiverId:n,data:{text:a}}))}}));return Object(s.b)("div",{className:C()("TextMessage",{"TextMessage-sender":"sender"===t.userType,"TextMessage-receiver":"receiver"===t.userType}),children:t.unfriendly&&"sender"===t.userType?Object(s.b)(ve,{message:t}):Object(s.b)(V.Text,{onClick:a,dangerouslySetInnerHTML:{__html:t.richText||t.text}})})},Oe=n(204);function je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var ye=function(e){Object(c.a)(n,e);var t=je(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={previewImg:null,imageUrl:e.props.image.url},e.getImageStyle=function(){var t=e.props.image,n=t.width,r=t.height,a=r/n;return r>B.d||n>B.d?a>1?{height:"".concat(B.d,"px"),minWidth:"".concat(B.g,"px")}:a<1?{width:"".concat(B.d,"px"),minHeight:"".concat(B.g,"px"),height:B.d*a}:{height:"".concat(B.d,"px"),width:"".concat(B.d,"px")}:{maxWidth:"".concat(B.d,"px"),maxHeight:"".concat(B.d,"px"),width:n,height:r}},e.isTempUrl=function(e){return e.startsWith("blob")},e.handleImageClick=function(t){var n=e.state.imageUrl;e.isTempUrl(n)||e.setState({previewImg:t.target})},e}return Object(a.a)(n,[{key:"componentDidUpdate",value:function(){var e=this,t=this.props.image.url,n=this.state.imageUrl;t!==n&&Object(re.loadImage)(t).then((function(){e.setState({imageUrl:t}),URL.revokeObjectURL(n)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.imageUrl,r=t.previewImg;return Object(s.c)("div",{children:[Object(s.b)("img",{className:C()("ImageMessage",{"ImageMessage--temp":this.isTempUrl(n)}),src:Object(re.imgUrl)(n,"hd"),onClick:this.handleImageClick,style:this.getImageStyle()}),r&&Object(s.b)(Oe.a,{className:"ImageMessage-ImageView",img:r,onClose:function(){return e.setState({previewImg:null})}})]})}}]),n}(l.Component);function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}ye.propTypes={image:p.a.shape({width:p.a.number,height:p.a.number,url:p.a.string})};var xe=function(e){Object(c.a)(n,e);var t=Me(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.sticker.url;return Object(s.b)("img",{className:"StickerMessage",src:Object(re.imgUrl)(e,"xl")})}}]),n}(l.Component);xe.propTypes={sticker:p.a.shape({id:p.a.string,url:p.a.string})};var ke=n(19),Ce=n(317),we=n(168),Re=function(e){var t=e.result,n=e.isInMessage,r=e.onClick,a=t.name,c=t.coverPath,o=void 0===c?"https://i1.wp.com/pic4.zhimg.com/80/v2-231f5c4e7db8b6c08493a220be85705e_hd.png?ssl=1":c,i=t.className,s=void 0===i?"":i,l=t.intro;return u.a.createElement("div",{className:C()("KfeCollection-MessageEventCard",s,{"KfeCollection-MessageEventCard--InMessage":n}),onClick:r},u.a.createElement("img",{src:o,className:"KfeCollection-MessageEventCard-cover"}),u.a.createElement("div",{className:"KfeCollection-MessageEventCard-content"},u.a.createElement("div",{className:"KfeCollection-MessageEventCard-title"},a),u.a.createElement("div",{className:"KfeCollection-MessageEventCard-text"},l)))},Ee=function(e){var t=e.result,n=e.onClick,r=e.isInMessage,a=void 0!==r&&r,c=e.hasClickZA,o=void 0===c||c,i=t.token,s=t.id;return u.a.createElement(W.b,{block:"EcomMessageEventCard",content:{type:we.a.event,id:s}},u.a.createElement(W.e,{shouldTrackClick:o,zaType:"Card",zaAction:"Unknown",zaText:"留资卡片",zaEventType:"Unknown",onClick:function(e){o&&me.a.trackEvent(e.target,{id:a?9970:10048,action:"Click",name:"留资卡片"}),n(i)}},u.a.createElement(Ce.a,{options:[{},a?{card:{content:{id:String(s)}}}:{},{id:a?9968:10046,name:"留资卡片"}]},u.a.createElement(Re,{result:t,isInMessage:a}))))};Ee.propTypes={className:p.a.string,result:p.a.object.isRequired,extra:p.a.shape({ua:p.a.object,theme:p.a.string}).isRequired};var Se=Ee,Te=n(39),Ie=n.n(Te),Ne=n(224),Be=n(744);function ze(){return(ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function De(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ae,Pe=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(Ae=Be.props)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(Ae)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}(),["sx","variant"]),Ue=new RegExp("^(".concat(Pe.join("|"),")$")),_e=/^m[trblxy]?$/,He=function(e){return function(t){var n={};for(var r in t)e(r||"")&&(n[r]=t[r]);return n}},Le=He((function(e){return Ue.test(e)})),Ke=He((function(e){return _e.test(e)})),Fe=He((function(e){return!_e.test(e)})),qe=function(e){e.size;var t=De(e,["size"]);return u.a.createElement(Ne.Box,ze({as:"svg",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"currentcolor"},t))},Ve=(Object(l.forwardRef)((function(e,t){return u.a.createElement(Ne.Flex,ze({ref:t,as:"label",tx:"forms",variant:"label"},e,{__css:{width:"100%"}}))})),Object(l.forwardRef)((function(e,t){return u.a.createElement(Ne.Box,ze({ref:t,as:"input",type:"text",tx:"forms",variant:"input"},e,{__css:{display:"block",width:"100%",p:2,appearance:"none",fontSize:"inherit",lineHeight:"inherit",border:"1px solid",borderRadius:"default",color:"inherit",bg:"transparent"}}))}))),Ge=function(e){return u.a.createElement(qe,e,u.a.createElement("path",{d:"M7 10l5 5 5-5z"}))},We=(Object(l.forwardRef)((function(e,t){return u.a.createElement(Ne.Flex,Ke(e),u.a.createElement(Ne.Box,ze({ref:t,as:"select",tx:"forms",variant:"select"},Fe(e),{__css:{display:"block",width:"100%",p:2,appearance:"none",fontSize:"inherit",lineHeight:"inherit",border:"1px solid",borderRadius:"default",color:"inherit",bg:"transparent"}})),u.a.createElement(Ge,{sx:{ml:-28,alignSelf:"center",pointerEvents:"none"}}))})),Object(l.forwardRef)((function(e,t){return u.a.createElement(Ne.Box,ze({ref:t,as:"textarea",tx:"forms",variant:"textarea"},e,{__css:{display:"block",width:"100%",p:2,appearance:"none",fontSize:"inherit",lineHeight:"inherit",border:"1px solid",borderRadius:"default",color:"inherit",bg:"transparent"}}))})),function(e){return u.a.createElement(qe,e,u.a.createElement("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}))}),Je=function(e){return u.a.createElement(qe,e,u.a.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}))},Qe=function(e){return u.a.createElement(u.a.Fragment,null,u.a.createElement(We,ze({},e,{__css:{display:"none","input:checked ~ &":{display:"block"}}})),u.a.createElement(Je,ze({},e,{__css:{display:"block","input:checked ~ &":{display:"none"}}})))},Ze=(Object(l.forwardRef)((function(e,t){var n=e.className,r=e.sx,a=e.variant,c=void 0===a?"radio":a,o=De(e,["className","sx","variant"]);return u.a.createElement(Ne.Box,null,u.a.createElement(Ne.Box,ze({ref:t,as:"input",type:"radio"},o,{sx:{position:"absolute",opacity:0,zIndex:-1,width:1,height:1,overflow:"hidden"}})),u.a.createElement(Ne.Box,ze({as:Qe,"aria-hidden":"true",tx:"forms",variant:c,className:n,sx:r},Le(o),{__css:{mr:2,borderRadius:9999,color:"gray","input:checked ~ &":{color:"primary"},"input:focus ~ &":{bg:"highlight"}}})))})),function(e){return u.a.createElement(qe,e,u.a.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}))}),Xe=function(e){return u.a.createElement(qe,e,u.a.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}))},$e=function(e){return u.a.createElement(u.a.Fragment,null,u.a.createElement(Ze,ze({},e,{__css:{display:"none","input:checked ~ &":{display:"block"}}})),u.a.createElement(Xe,ze({},e,{__css:{display:"block","input:checked ~ &":{display:"none"}}})))},Ye=(Object(l.forwardRef)((function(e,t){var n=e.className,r=e.sx,a=e.variant,c=void 0===a?"checkbox":a,o=De(e,["className","sx","variant"]);return u.a.createElement(Ne.Box,null,u.a.createElement(Ne.Box,ze({ref:t,as:"input",type:"checkbox"},o,{sx:{position:"absolute",opacity:0,zIndex:-1,width:1,height:1,overflow:"hidden"}})),u.a.createElement(Ne.Box,ze({as:$e,"aria-hidden":"true",tx:"forms",variant:c,className:n,sx:r},Le(o),{__css:{mr:2,borderRadius:4,color:"gray","input:checked ~ &":{color:"primary"},"input:focus ~ &":{color:"primary",bg:"highlight"}}})))})),Object(l.forwardRef)((function(e,t){var n=ze({},e);return u.a.createElement(Ne.Box,ze({ref:t,as:"input",type:"range",tx:"forms",variant:"slider"},n,{__css:{display:"block",width:"100%",height:4,my:2,cursor:"pointer",appearance:"none",borderRadius:9999,color:"inherit",bg:"gray",":focus":{outline:"none",color:"primary"},"&::-webkit-slider-thumb":{appearance:"none",width:16,height:16,bg:"currentcolor",border:0,borderRadius:9999,variant:"forms.slider.thumb"}}}))})),Object(l.forwardRef)((function(e,t){var n=e.checked,r=De(e,["checked"]);return u.a.createElement(Ne.Box,ze({ref:t,as:"button",type:"button",role:"switch",tx:"forms",variant:"switch","aria-checked":n},r,{__css:{appearance:"none",m:0,p:0,width:40,height:24,color:"primary",bg:"transparent",border:"1px solid",borderColor:"primary",borderRadius:9999,"&[aria-checked=true]":{bg:"primary"},":focus":{outline:"none",boxShadow:"0 0 0 2px"}}}),u.a.createElement(Ne.Box,{"aria-hidden":!0,style:{transform:n?"translateX(16px)":"translateX(0)"},sx:{mt:"-1px",ml:"-1px",width:24,height:24,borderRadius:9999,border:"1px solid",borderColor:"primary",bg:"background",transitionProperty:"transform",transitionTimingFunction:"ease-out",transitionDuration:"0.1s",variant:"forms.switch.thumb"}}))})),function(e){var t=e.className,n=void 0===t?"":t,r=e.eventData,a=e.onClose,c=e.onSubmit,o=e.extra,i=r.token,s=r.name,d=r.intro,p=r.submitText,b=o.originPhone,m=Object(l.useState)(b),v=Ie()(m,2),g=v[0],O=v[1],j=function(e){me.a.trackEvent(e.target,{id:9972,action:"Submit"}),c({token:i,phone:g})};return u.a.createElement(W.b,{block:"EcomMessageEventModal",content:{type:we.a.event}},u.a.createElement(W.e,{zaText:"留资卡片",zaType:"Popup"},u.a.createElement(Ce.a,{options:[{},{},{id:9971,name:"留资卡片"}]},u.a.createElement(f.b,{title:s,onClose:a,className:C()("KfeCollection-MessageEventModal",n),key:i},u.a.createElement("div",{className:"KfeCollection-MessageEventModal-intro"},d),u.a.createElement(Ve,{className:"KfeCollection-MessageEventModal-phone",placeholder:"点击输入用户手机号码",value:g,onChange:function(e){O(e.target.value)},fontSize:"14px",color:"GBK02A",width:"100%"}),u.a.createElement("div",{className:"KfeCollection-MessageEventModal-buttonGroup"},u.a.createElement(W.a,{zaType:"Button",zaAction:"Unknown",zaText:"取消",onClick:function(e){me.a.trackEvent(e.target,{id:9972,action:"Cancel"}),a()}},u.a.createElement(h.c,{className:"KfeCollection-MessageEventModal-cancelButton"},"取消")),g?u.a.createElement(W.a,{zaType:"Button",zaAction:"Unknown",zaText:p||"确认报名"},u.a.createElement(h.c,{onClick:j,preset:h.b.Primary,color:h.a.Blue,type:"submit"},p||"确认报名")):u.a.createElement(h.c,{onClick:j,disabled:!g,preset:h.b.Primary,color:h.a.Blue,type:"submit"},p||"确认报名"))))))});Ye.propTypes={className:p.a.string,eventData:p.a.object.isRequired,extra:p.a.shape({ua:p.a.object,theme:p.a.string,originPhone:p.a.any}).isRequired,onClose:p.a.func,onSubmit:p.a.func};var et=Ye,tt=n(359),nt=function(e){var t=e.senderId,n=e.message,r=e.isEcomMerchant,a=Object(m.useDispatch)(),c=Object(m.useSelector)((function(e){var t;return null===(t=e.account.accountInfo)||void 0===t?void 0:t.phoneNo})),o=Object(l.useState)({}),i=Object(T.a)(o,2),u=i[0],d=i[1],p=Object(l.useState)(!1),f=Object(T.a)(p,2),h=f[0],b=f[1],v=Object(l.useMemo)((function(){return Object(ke.camelizeKeys)(n)}),[n]),O=v.ecomCard,j=void 0===O?{}:O,y=Object(l.useMemo)((function(){return function(e){var t,n=e.data,r=void 0===n?{}:n,a=e.title;return{cardData:Object.assign({},r,{name:r.name||a,coverPath:r.cover}),sendModalData:Object.assign({},r,{name:r.name||a,submitText:null==r||null===(t=r.formFields)||void 0===t?void 0:t.submitText})}}(j)}),[j]),M=function(){b(!1)};return Object(s.c)(s.a,{children:[1===j.cardType&&Object(s.b)(Se,{result:Object.assign({},y.cardData,{id:v.id}),extra:{},isInMessage:!0,hasClickZA:!r||r&&"sender"===n.userType,onClick:function(){return e={type:"event",info:y.sendModalData,camelMessage:v},t=e.info,void(r&&"receiver"===n.userType?a(Object(de.g)("商家不能参与自己发起的活动哦")):(d(Object.assign({},t)),b(!0)));var e,t}}),2===j.cardType&&Object(s.b)(ge,{message:Object.assign({},n,{text:"web 上暂不支持优惠券消息，请至 app 查看"})}),h&&Object(s.b)(et,{eventData:u,extra:{originPhone:c},onSubmit:function(e){return function(e){var n=e.cardType,r=e.modalData;if(1===n){var c=r.token,o=r.phone,i={receiverId:t,phone:o};a(Object(g.n)({contentType:"ecomcard",token:c,data:i})).then((function(){M()})).catch(tt.a)}}({cardType:1,modalData:e})},onClose:M})]})},rt=n(60),at=function(e){return new RegExp(/https:\/\/www.zhihu.com\/inbox\/+[\s\S]*?is_ecom=1/).test(e)};var ct=function(e){var t=e.senderId,n=e.message,r=e.isEcomMerchant,a=void 0!==r&&r,c=Object(m.useDispatch)(),o=Object(W.i)().trackEvent,i=Object(l.useState)(""),u=Object(T.a)(i,2),d=u[0],p=u[1],f=Object(I.b)((function(e){if(!e)return"";var t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelectorAll("a");if(!n.length)return"";n.forEach((function(e){at(e.href)&&e.setAttribute("data-za-not-track-link",!0)})),p(t.querySelector("body").innerHTML)}));Object(l.useEffect)((function(){f(n.richText||n.text)}),[f,n]);var h=Object(I.b)((function(e){var r,i,s,l,u=e.target,d=u.tagName,p=u.href;if("A"===d){if(p&&!at(p))return;if(e.stopPropagation(),e.preventDefault(),a&&"receiver"===n.userType)return void c(Object(de.g)("您不可以点击自己的卡片哦"));me.a.trackEvent(e.target,{id:9969,action:"Click",name:"欢迎语卡片"},{module:[{card:{content:{type:"Message",id:String(n.id)}}}]}),o({block:"EcomWelcome",action:"Unknown",eventType:"Click",elementLocation:{type:"Text",content:{type:"Message",id:n.id}}}),r=e,s=n.id,l=n.contentType,c(Object(g.o)({contentType:l,receiverId:t,data:(i={},Object(_.a)(i,l,n[l]),Object(_.a)(i,"text",r.target.text||"问题等待配置"),i),tempMessageId:s}))}}));return Object(s.b)("div",{className:C()("TextMessage","EcomWelcomeTextMessage",{"TextMessage-sender":"sender"===n.userType,"TextMessage-receiver":"receiver"===n.userType}),children:Object(s.b)(W.b,{block:"MessageEcomWelcomeCard",content:{type:"Message",id:n.id},children:Object(s.b)(W.e,{zaType:"Card",zaAction:"Unknown",zaText:"交付欢迎语卡片",zaEventType:"Unknown",onClick:h,children:Object(s.b)(rt.a,{trackCardShow:!0,view:{id:9968,name:"欢迎语卡片"},extra:{module:[{card:{content:{id:String(n.id)}}}]},children:Object(s.b)(V.Text,{dangerouslySetInnerHTML:{__html:d}})})})})})},ot=n(73),it=function(e){return(new Date).getTime()-Number(e)<864e5?Object(ot.toSmartString)(e):Object(ot.toAbsoluteDateTimeString)(e)},st=function(e){var t=e.time;if(!t)return null;var n=new Date(t);return Object(s.b)("time",{dateTime:n.toISOString(),children:it(n)})},lt=Object(l.memo)(st),ut=function(e){var t=e.message,n=e.onRequestReport,r=e.onRequestBlock,a=Object(l.useRef)(),c=Object(l.useContext)(A),o=c.showModal,i=c.setShowModal;return Object(s.b)(V.Text,{ref:a,m:"20px auto",p:"10px 12px",bg:"GBK10A",color:"GBK07A",maxWidth:388,minHeight:40,fontSize:12,sx:{lineHeight:"20px",borderRadius:"8px",a:{color:"primary"}},dangerouslySetInnerHTML:{__html:Object(l.useMemo)((function(){return t.text.replace("https://www.zhihu.com/report?report_location=1","#report").replace("http://www.zhihu.com/defriend","#block")}),[t.text])},onClick:function(e){var t=e.target.href;t&&(e.preventDefault(),n&&t.endsWith("#report")?(n(),me.a.trackEvent(a.current,{action:"Click",id:6882})):r&&t.endsWith("#block")?(r(),me.a.trackEvent(a.current,{action:"Click",id:6883})):!function(e){return D.includes(e)}(t)?window.open(t,"_blank"):o||i(!0))}})},dt=n(513),pt=n(1113);function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var ht=function(e){Object(c.a)(n,e);var t=ft(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.showReport,n=e.className,r=e.onReportClick,a=e.onMessageDelete;return Object(s.c)("ul",{className:C()("ActionMenu",n),children:[Object(s.b)("li",{className:"ActionMenu-item",onClick:a,children:"删除"}),t&&Object(s.b)("li",{className:"ActionMenu-item",onClick:r,children:"举报"})]})}}]),n}(l.Component);ht.propsTypes={className:p.a.string,showReport:p.a.bool,onMessageDelete:p.a.func.isRequired,onReportClick:p.a.func.isRequired};var bt=function(e,t){var n=e.isOpen,r=e.onToggleMenu,a=e.onDeleteClick,c=e.onReportClick,o=e.showReport;Object(l.useEffect)((function(){if(n)return window.addEventListener("wheel",r),function(){window.removeEventListener("wheel",r)}}),[n,r]);var i=Object(l.useCallback)((function(e){e.stopPropagation(),r()}),[r]);return Object(s.c)(s.a,{children:[Object(s.b)("button",{type:"button",onClick:i,"aria-label":"更多",ref:t,className:"Chat-ActionMenuPopover-Button",children:Object(s.b)(pt.a,{className:"Message-status--more"})}),Object(s.b)(dt.a,{isOpen:n,fixed:!0,arrowed:!0,target:null==t?void 0:t.current,children:Object(s.b)(ht,{onMessageDelete:a,onReportClick:c,showReport:o})})]})},mt=Object(l.forwardRef)(bt);function vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var gt=function(e){Object(c.a)(n,e);var t=vt(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).ref=Object(l.createRef)(),e.state={isMoreActionMenuShow:!1,isReportModalShow:!1,isShieldUserModalShown:!1},e.handleDocClick=function(t){e.state.isMoreActionMenuShow&&e.ref.current&&!e.ref.current.contains(t.target)&&(t.stopPropagation(),t.preventDefault(),e.setState({isMoreActionMenuShow:!1}))},e.toggleMoreActionMenu=function(){e.setState({isMoreActionMenuShow:!e.state.isMoreActionMenuShow})},e.handleMessageDelete=function(){var t=e.props,n=t.deleteMessage,r=t.message.id,a=t.sender.id;L.a.confirm(Object(s.b)("div",{style:{textAlign:"center"},children:"是否删除该条消息"}),{title:"删除消息"}).then((function(){return n(r,a)}),(function(){}))},e.handleReSendMessage=function(){var t=e.props,n=t.deleteLocalMessage,r=t.sender.id,a=t.sendMessage,c=t.message,o=c.id,i=c.contentType;if(i!==B.a.ecomcard)if(i!==B.a.image)n(o,r),a({contentType:i,receiverId:r,data:Object(_.a)({},i,c[i]),tempMessageId:o});else{var s=c.image.url;if(s.startsWith("blob")){var l=c.file,u=e.props,d=u.uploadImage,p=u.setImageSendFailure,f=o;d(l).then((function(e){return a({contentType:B.a.image,receiverId:r,data:{image:{height:e.payload.dataRawheight,width:e.payload.dataRawwidth,url:e.payload.src}},tempMessageId:f})})).then((function(){URL.revokeObjectURL(s)})).catch((function(){p({tempMessageId:f,receiverId:r,file:l})}))}else a({contentType:i,receiverId:r,data:Object(_.a)({},i,c[i]),tempMessageId:o})}},e.handleReSendIconClick=function(){L.a.confirm(null,{title:"是否重新发送消息"}).then((function(){e.handleReSendMessage()}),(function(){}))},e.renderMessage=function(t){var n=e.props,r=n.sender.id,a=n.isEcomMerchant,c=n.sendMessage,o=t.isEcomWelcomeCard;return t.contentType===B.a.text?o?Object(s.b)(ct,{senderId:r,message:t,isEcomMerchant:a}):Object(s.b)(ge,{message:t,senderId:r,sendMessage:c}):t.contentType===B.a.image?Object(s.b)(ye,{image:t.image}):t.contentType===B.a.sticker?Object(s.b)(xe,{sticker:t.sticker}):t.contentType===B.a.ecomcard?Object(s.b)(nt,{senderId:r,message:t,isEcomMerchant:a}):"web 上暂不支持此类消息，请至 app 查看"},e.toggleReportModal=function(){e.setState({isReportModalShow:!e.state.isReportModalShow})},e.renderMessageStatus=function(t){if(t===B.e.success){var n=e.state.isMoreActionMenuShow,r="receiver"===e.props.message.userType;return Object(s.b)("div",{className:"Message-status--wrapper",children:Object(s.b)(mt,{ref:e.ref,isOpen:n,onToggleMenu:e.toggleMoreActionMenu,onDeleteClick:e.handleMessageDelete,onReportClick:e.toggleReportModal,showReport:!r})})}return t===B.e.loading?Object(s.b)(ie.a,{className:"Message-status--loading"}):t===B.e.failure?Object(s.b)(H.a,{className:"Message-status--failure",onClick:e.handleReSendIconClick}):null},e}return Object(a.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleDocClick)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleDocClick)}},{key:"render",value:function(){var e=this,t=this.props,n=t.message,r=t.sender,a=t.receiver,c=n.type,o=n.userType,i=n.status,l=n.showTime,u=n.createdTime,d=n.id,p=this.state,f=p.isReportModalShow,h=p.isShieldUserModalShown,b=Object(s.b)(s.a,{children:l&&Object(s.b)("p",{className:"Message-time",children:Object(s.b)(lt,{time:u})})});if("risk_tip"===c||"tip"===c)return Object(s.c)(s.a,{children:[b,f&&Object(s.b)(se.a,{type:"message",urlToken:n.associateId,shown:!0,onClose:this.toggleReportModal}),h&&Object(s.b)(he,{shown:h,onClose:function(){return e.setState({isShieldUserModalShown:!1})},user:r}),Object(s.b)(ut,{message:n,onRequestReport:this.toggleReportModal,onRequestBlock:function(){e.setState({isShieldUserModalShown:!0})}})]});var m="receiver"===o?a:r;return Object(s.c)("div",{className:"Message-wrapper",children:[b,f&&Object(s.b)(se.a,{type:"message",urlToken:d,shown:!0,onClose:this.toggleReportModal}),Object(s.c)("div",{className:C()("Message",{"Message--reverse":"receiver"===o}),children:[Object(s.b)(oe,{user:m,size:40}),Object(s.c)("div",{className:C()("Message-content",{"Message-content--reverse":"receiver"===o}),children:[this.renderMessage(n),Object(s.b)("div",{className:"Message-status",children:this.renderMessageStatus(i)})]})]})]})}}]),n}(l.Component);gt.propsTypes={message:p.a.object,sender:p.a.object,receiver:p.a.object};var Ot=Object(m.connect)(null,{deleteMessage:g.f,deleteLocalMessage:g.e,sendMessage:g.o,setImageSendFailure:g.p,uploadImage:K.b})(gt);function jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var yt=function(e){Object(c.a)(n,e);var t=jt(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={showQuestionTagModal:!1},e.scrollToBottom=function(){e.messageBoxEle.scrollTop=e.messageBoxEle.scrollHeight},e.handleGetHistoryMessage=function(t){var n=e.props,r=n.isLoading,a=n.nextApiUrl,c=n.getHistoryMessages,o=n.senderId,i=n.isEnd;!t||r||i||c({senderId:o,nextApiUrl:a})},e.setShowQuestionTagModal=function(t){return e.setState({showQuestionTagModal:t})},e}return Object(a.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.getHistoryMessages,n=e.senderId,r=e.messages,a=e.setMessageRead,c=e.sender,o=void 0===c?{}:c;0!==r.length&&o.id?this.scrollToBottom():t({senderId:n}).catch((function(){location.href="//www.zhihu.com/messages"})),a(n)}},{key:"componentDidUpdate",value:function(e){var t=e.messages,n=void 0===t?[]:t,r=this.props,a=r.messages,c=r.setMessageRead,o=r.senderId,i=n[n.length-1]||{},s=a[a.length-1]||{};i.id!==s.id&&(this.scrollToBottom(),"sender"===s.userType&&c(o));var l=e.sender,u=(l=void 0===l?{}:l).id,d=this.props.sender;(d=void 0===d?{}:d).id!==u&&this.scrollToBottom()}},{key:"render",value:function(){var e=this,t=this.props,n=t.messages,r=t.receiver,a=t.sender,c=void 0===a?{}:a,o=t.senderId,i=t.isLoading,l=t.isEcomMerchant,u=this.state.showQuestionTagModal;return c.id?Object(s.c)(A.Provider,{value:{showModal:u,setShowModal:this.setShowQuestionTagModal},children:[Object(s.b)(E.b,{isLoading:i,onLoad:this.handleGetHistoryMessage,placeholder:Object(s.b)(R.a,{className:"MessagesBox-loading"}),isPrevDrained:!1,isDrained:!0,getContainer:function(e){return e},className:"MessagesBox",onRef:function(t){e.messageBoxEle=t},children:n.map((function(e){return Object(s.b)("div",{children:Object(s.b)(Ot,{message:e,receiver:r,sender:c,isEcomMerchant:l})},e.tempMessageId||e.id)}))}),Object(s.b)(U,{showModal:u,onClose:function(){return e.setShowQuestionTagModal(!1)},senderId:o})]}):Object(s.b)(R.a,{className:"MessagesBox-loading"})}}]),n}(l.Component);yt.PropsTypes={senderId:p.a.string};var Mt=Object(w.compose)(Object(m.connect)((function(e,t){var n=t.senderId,r=e.chat.chats[n]||{},a=r.receiver,c=void 0===a?{}:a,o=r.sender,i=void 0===o?{}:o,s=r.messages,l=void 0===s?[]:s,u=r.isLoading,d=void 0!==u&&u,p=r.isEnd;return{receiver:c,sender:i,messages:l,isLoading:d,isEnd:void 0===p||p,nextApiUrl:r.nextApiUrl,isEcomMerchant:(e.chat.chats||{}).isEcomMerchant}}),{getHistoryMessages:g.j,setMessageRead:g.q}),Object(S.a)())(yt),xt=n(46),kt=n(118),Ct=n.n(kt),wt=n(95),Rt=n(281),Et=n(28),St=n(380),Tt=n(1116);function It(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var Nt=function(e){Object(c.a)(n,e);var t=It(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).checkSize=function(t){var n=e.props.showNotification;if(t.size>1024*Et.G*1024)return n("请上传小于 ".concat(Et.G,"M 的图片。"),"red"),!1},e.sendImage=function(t){var n=t.file;(0,e.props.handleSendImage)(n)},e}return Object(a.a)(n,[{key:"render",value:function(){var e=this,t=this.props.className;return Object(s.b)(St.a,{accept:"image/png,image/jpeg",onRef:function(t){e.uploadInput=t},customUpload:this.sendImage,beforeUpload:this.checkSize,multiple:!0,children:Object(s.b)(Tt.a,{className:t})})}}]),n}(l.Component);Nt.propTypes={senderId:p.a.string,className:p.a.string,handleSendImage:p.a.func};var Bt=Object(m.connect)(null,{showNotification:de.g})(Nt),zt=n(1117),Dt=n(529),At=n(533);function Pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var Ut=function(e){Object(c.a)(n,e);var t=Pt(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={isEmoticonsHidden:!0},e.toggleEmoticonPanel=function(){e.setState({isEmoticonsHidden:!e.state.isEmoticonsHidden})},e.handleSelectEmoticon=function(t,n){var r=e.props,a=r.insertEmoji,c=r.handleSendEmoticon;"emoji"===n?a(t.placeholder):c(t),e.toggleEmoticonPanel()},e}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.className,t=this.state.isEmoticonsHidden;return Object(s.c)("div",{className:"EmoticonTool",children:[!t&&Object(s.b)("div",{className:"EmoticonTool--mask",onClick:this.toggleEmoticonPanel}),!t&&Object(s.b)(At.a,{className:"EmoticonTool-panel",onSelectEmoticon:this.handleSelectEmoticon}),Object(s.b)(zt.a,{className:C()("EmoticonTool-icon",e),onClick:this.toggleEmoticonPanel})]})}}]),n}(l.Component);Ut.propTypes={senderId:p.a.string,className:p.a.string};var _t=Object(Dt.a)()(Ut),Ht=n(14),Lt={0:{prefix:null,text:"免费",key:""},1:{prefix:"¥",key:"discountPrice"},2:{prefix:"¥",key:"discountPrice"},3:{suffix:"折",key:"discountRate"}},Kt=function(e){var t=e.couponInfo,n=void 0===t?{}:t,r=n.couponType,a=Lt[void 0===r?1:r],c=a.text||"discountPrice"===a.key?n[a.key]/100:n[a.key];return u.a.createElement("div",{className:C()("KfeCollection-MessageCouponCard-coupon")},a.prefix&&u.a.createElement("span",{className:C()("KfeCollection-MessageCouponCard-tag","tag-prefix")},a.prefix),c,a.suffix&&u.a.createElement("span",{className:C()("KfeCollection-MessageCouponCard-tag","tag-suffix")},a.suffix))},Ft=function(e){var t=e.result,n=e.isInMessage,r=t.title,a=t.description,c=t.className,o=void 0===c?"KfeCollection-MessageCouponCard-orangeCoupon--light":c;return u.a.createElement("div",{className:C()("KfeCollection-MessageCouponCard",o,{"KfeCollection-MessageCouponCard--InMessage":n})},u.a.createElement("div",{className:"KfeCollection-MessageCouponCard-content"},u.a.createElement("div",{className:"KfeCollection-MessageCouponCard-title"},r),u.a.createElement("div",{className:"KfeCollection-MessageCouponCard-text"},a)),u.a.createElement(Kt,{couponInfo:t}))},qt=function(e){var t=e.result,n=e.onClick,r=e.isInMessage,a=void 0!==r&&r,c=e.extra.theme,o=void 0===c?"light":c,i=t.id;return u.a.createElement(W.b,{block:"EcomMessageCouponCard",content:{type:we.a.coupon,id:i}},u.a.createElement(W.a,{shouldTrackShow:!0,zaType:"Card",zaAction:"Unknown",zaText:"留资卡片",zaEventType:"Unknown",onClick:function(e){me.a.trackEvent(e.target,{id:10049,action:"Click",name:String(i)}),n()}},u.a.createElement(Ce.a,{options:[{},{},{id:10047,name:String(i)}]},u.a.createElement(Ft,{result:t,isInMessage:a,theme:o}))))};qt.propTypes={className:p.a.string,result:p.a.object.isRequired,extra:p.a.shape({ua:p.a.object,theme:p.a.string,styles:p.a.object}).isRequired};var Vt=qt,Gt=n(357),Wt=n(72),Jt=Object.assign;var Qt=function(e){return u.a.createElement(Wt.a,Jt({width:"24",height:"24",fill:"none",viewBox:"0 0 26 26"},e),u.a.createElement("path",{fill:"#fff",d:"M0 0h24v24H0z",opacity:".01"}),u.a.createElement("path",{fill:"#646464",d:"M16.875 7.149c.182 1.255-.302 3.01-1.436 5.369-.328.6-.62 1.479-.597 1.768.013.169.08.316.215.448l3.042-3.042a1.626 1.626 0 012.228-.068l.747.742c.611.612.634 1.59.068 2.228l-1.483 1.487c.455.17 1 .51 1.314.982.315.471.532 1.493.532 3.177 0 .663-.532 1.273-1.236 1.273l-6.062-.015c-.25.193-.528.346-.826.453l-2.161.652a.85.85 0 01-.844-.212c-.203-.203-.318-.5-.2-.896-.003.003-6.924.018-6.924.018A1.247 1.247 0 012 20.259l.013-1.49c-.013-.77.13-1.155.314-1.435.181-.274.443-.54.63-.73l.014-.013c.445-.452 1.444-.737 2.777-.98 2.487-.454 2.875-.819 2.915-1.325.01-.131-.162-.851-.548-1.606-1.255-2.444-1.705-3.934-1.49-5.502C6.944 4.827 8.662 3 11.752 3c3.09 0 4.776 1.77 5.122 4.149zm.65 6.886l-5.272 5.282c-.271.332-.678 1.873-.678 1.873s1.582-.41 1.92-.721l5.235-5.229-1.205-1.205zM8.11 7.382C8.391 5.7 9.513 4.506 11.754 4.5c2.241-.005 3.397 1.221 3.635 2.863.129.883-.288 2.394-1.285 4.469-.439.8-.81 1.918-.758 2.57a2.12 2.12 0 00.649 1.393l-2.577 2.582c-.557.62-.79 1.614-.79 1.614l-7.125.02.012-1.334c0-.408.08-.634.36-.873.233-.2.552-.34.877-.439.451-.11.918-.208 1.372-.303 1.016-.214 1.972-.415 2.563-.706.866-.426 1.378-1.061 1.472-1.954.075-.707-.72-2.44-.72-2.44S7.85 8.956 8.111 7.382zm10.34 9.91l-2.713 2.71 4.26.008s-.056-1.624-.213-2.012c-.082-.155-.275-.458-1.335-.707zm.575-4.752a.375.375 0 01.489.036l.71.717a.376.376 0 01-.036.489l-.574.574-1.206-1.206.617-.61z",fillRule:"evenodd",clipRule:"evenodd"}))},Zt=Object.assign;var Xt=function(e){return u.a.createElement(Wt.a,Zt({width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"},e),u.a.createElement("path",{fill:"#fff",d:"M0 0h24v24H0z",opacity:".01"}),u.a.createElement("path",{fill:"#646464",d:"M3.004 18.5a2.285 2.285 0 002.285 2.284h13.736a2.285 2.285 0 002.285-2.285v-3.732a.763.763 0 00-.759-.846h-.01a1.526 1.526 0 01.01-3.053.763.763 0 00.759-.847V6.29a2.285 2.285 0 00-2.285-2.285H5.289A2.285 2.285 0 003.004 6.29v3.732a.763.763 0 00.759.846h.015a1.526 1.526 0 01-.015 3.053.763.763 0 00-.759.846v3.732zM17.5 12.394c0 1.423.975 2.62 2.293 2.957v3.147a.768.768 0 01-.767.768H5.289a.768.768 0 01-.767-.768v-3.147a3.054 3.054 0 000-5.915V6.29c0-.424.343-.768.767-.768h13.736c.424 0 .767.344.767.768v3.147a3.054 3.054 0 00-2.293 2.958zm-3.807 0a1.535 1.535 0 11-3.07 0 1.535 1.535 0 013.07 0zm1.517 0a3.052 3.052 0 11-6.104 0 3.052 3.052 0 016.104 0z",fillRule:"evenodd",clipRule:"evenodd"}))},$t=n(69),Yt=n.n($t),en=n(522),tn=n.n(en),nn=function(e){var t=e.cardList,n=e.onSend,r=e.onClose,a=e.isEvent,c=a?Se:Vt;return Object(s.b)(f.b,{title:a?"活动":"优惠券",onClose:r,className:"EcomCardTool-Modal",children:Object(s.b)("ul",{className:"EcomCardTool-Modal--list",children:t.map((function(e,t){return Object(s.b)("li",{className:"EcomCardTool-Modal--cardItem",children:Object(s.b)(c,{result:e,extra:{},onClick:function(){return n(Object.assign({},e,{cardType:a?1:2}))}})},e.token||t)}))})})};nn.propTypes={onClose:p.a.func.isRequired,cardList:p.a.array,onSend:p.a.func};var rn=function(e){var t=e.senderId,n=e.className,r=e.isEvent,a=e.onHandleFirstInterActive,c=Object(m.useSelector)((function(e){return e.env.theme})),o=Object(m.useDispatch)(),i=Object(l.useState)(!1),u=Object(T.a)(i,2),d=u[0],p=u[1],f=Object(l.useState)([]),h=Object(T.a)(f,2),b=h[0],v=h[1],O=Object(I.b)((function(){o(Object(g.h)({senderId:t})).then((function(e){var t;return v(null===(t=e.payload)||void 0===t?void 0:t.data)}))})),j=Object(I.b)((function(){o(Object(g.g)()).then((function(e){var t,n,r;return n=null===(t=e.payload)||void 0===t?void 0:t.data,r=!tn()(n)&&n.map((function(e){return Object.assign({},e,{className:1===(null==e?void 0:e.template.id)?"KfeCollection-MessageCouponCard-orangeCoupon--".concat(c):"KfeCollection-MessageCouponCard-blueCoupon--".concat(c),description:e.intro})}))||[],void v(Object(Ht.a)(r))}))}));Object(l.useEffect)((function(){r&&O()}),[r,O]),Object(l.useEffect)((function(){r||j()}),[r,j]);var y=r?Qt:Xt,M=function(e){var n=e.token,r=e.cardType,c=e.id;(function(e){var n=e.token,r=e.cardType;if(a(),1===r){var c=Ct()("TempEventCard_");return o(Object(g.a)(t,c,r)),o(Object(g.m)({contentType:B.a.ecomcard,token:n,data:{receiverId:t,cardType:r},tempMessageId:c}))}return o(Object(g.m)({contentType:B.a.ecomcard,id:n,data:{receiverId:t,cardType:r}}))})({token:n||c,cardType:r}).then((function(){p(!1)})).catch(Yt.a)};return Object(s.b)(W.b,{block:"EcomMessageEcomCardTool",content:{type:"Message"},children:Object(s.b)(rt.a,{trackCardShow:!0,view:{id:r?9975:9976,url:"fakeurl://dialogue/user.*"},children:Object(s.c)("div",{className:"EcomCardTool",children:[Object(s.b)(W.e,{shouldTrackClick:!0,zaText:r?"留资卡片":"优惠券卡片",zaType:"Button",zaEventType:"Click",children:Object(s.b)(y,{className:C()("EcomCardTool-icon",n),width:22,height:22,onClick:function(e){d||!tn()(b)?(p(!d),Object(Gt.a)(e,{id:r?9978:9979,action:"Click"})):o(Object(de.g)("请先去 ecom.zhihu.com 配置","red"))}})}),d&&Object(s.b)(nn,{isEvent:r,cardList:b,onSend:function(e){return M(e)},onClose:function(){return p(!1)}})]})})})};rn.propTypes={senderId:p.a.string,className:p.a.string,isEvent:p.a.bool,onHandleFirstInterActive:p.a.func};var an=rn;function cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var on=function(e){Object(c.a)(n,e);var t=cn(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.senderId,n=e.insertEmoji,r=e.handleSendImage,a=e.handleSendEmoticon,c=e.onHandleFirstInterActive,o=e.isEcomMerchant;return Object(s.c)("ul",{className:"ToolBar",children:[Object(s.b)("li",{className:"ToolBar-item",children:Object(s.b)(_t,{className:"ToolBar-Icon",senderId:t,insertEmoji:n,handleSendEmoticon:a})}),Object(s.b)("li",{className:"ToolBar-item",children:Object(s.b)(Bt,{className:"ToolBar-Icon",senderId:t,handleSendImage:r})}),o&&Object(s.c)(s.a,{children:[Object(s.b)("li",{className:"ToolBar-item",children:Object(s.b)(an,{isEvent:!0,className:"ToolBar-Icon",senderId:t,onHandleFirstInterActive:c},"event")},"event"),Object(s.b)("li",{className:"ToolBar-item",children:Object(s.b)(an,{isEvent:!1,className:"ToolBar-Icon",senderId:t,onHandleFirstInterActive:c},"coupon")},"coupon")]})]})}}]),n}(l.Component);on.propTypes={senderId:p.a.string,insertEmoji:p.a.func,handleSendImage:p.a.func,handleSendEmoticon:p.a.func,onHandleFirstInterActive:p.a.func};var sn=Object(m.connect)((function(e){return{isEcomMerchant:(e.chat.chats||{}).isEcomMerchant}}))(on),ln=function(e){var t=Object(l.useState)(!1),n=Object(T.a)(t,2),r=n[0],a=n[1];return r?null:Object(s.b)(un,Object.assign({},e,{dispose:function(){return a(!0)}}))},un=function(e){var t=e.endSignal,n=void 0!==t&&t,r=e.dispose,a=Object(l.useState)(0),c=Object(T.a)(a,2),o=c[0],i=c[1];Object(l.useEffect)((function(){i(Date.now())}),[]);var s=Object(I.b)((function(e){var t=e-o;t>0&&t<=6e4&&(Object(Gt.a)(null,{id:9980,action:"StatusReport"}),null==r||r())}));return Object(l.useEffect)((function(){if(n){var e=Date.now();s(e)}}),[s,n]),Object(I.g)(r,6e4),null};ln.propTypes={endSignal:p.a.bool};var dn=ln;function pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var fn=function(e){Object(c.a)(n,e);var t=pn(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={cursorPosition:0,firstInteractive:!1},e.inputRef=Object(l.createRef)(),e.countDownTimer=null,e.handleSetFirsetInteractive=function(){e.setState({firstInteractive:!0})},e.checkSize=function(t){var n=e.props.showNotification;return!(t.size>1024*Et.G*1024)||(n("请上传小于 ".concat(Et.G,"M 的图片。"),"red"),!1)},e.handleKeyDown=function(t){var n=e.props,r=n.inputMessage,a=n.senderId,c=n.inputValue;13===t.keyCode&&(t.ctrlKey||t.metaKey)?r({senderId:a,inputValue:"".concat(c,"\n")}):13!==t.keyCode||t.shiftKey||e.handleSendTextMessage(t)},e.handleSendImage=function(t){var n;if(t&&e.checkSize(t)){var r=e.props,a=r.uploadImage,c=r.sendMessage,o=r.senderId,i=r.addTempImageMessage,s=r.setImageSendFailure,l=Ct()("TempImage_");e.handleSetFirsetInteractive(),Object(Rt.a)(t).then((function(e){var n=URL.createObjectURL(e);Object(re.loadImage)(n).then((function(r){var u=r.height,d=r.width;i(o,n,l,u,d),a(e).then((function(e){return c({contentType:B.a.image,receiverId:o,data:{image:{height:e.payload.dataRawheight,width:e.payload.dataRawwidth,url:e.payload.src}},tempMessageId:l})})).catch((function(){s({tempMessageId:l,receiverId:o,file:t})}))}))})),null===(n=e.inputRef.current)||void 0===n||n.focus()}},e.handleSendEmoticon=function(t){var n,r=t.id,a=t.dynamicImageUrl,c=t.staticImageUrl,o=t.title,i=e.props,s=i.senderId,l=i.sendMessage;e.handleSetFirsetInteractive(),l({contentType:"sticker",receiverId:s,data:{sticker:{sticker_id:r,url:a||c,title:o}}}),me.a.trackEvent(null,{id:3640,action:"Click",name:o}),null===(n=e.inputRef.current)||void 0===n||n.focus()},e.handleSendTextMessage=function(t){var n=e.props,r=n.senderId,a=n.sendMessage,c=n.inputValue,o=n.location.query,i=o.source_type,s=o.source_id;c.length>1e4?L.a.alert("发送文字不得超过 1 万字，请重新编辑后再次发送",{title:"发送失败"}):c.trim()&&(e.handleSetFirsetInteractive(),t.preventDefault(),a({contentType:B.a.text,receiverId:r,data:{text:c},sourceType:i,sourceId:s}),me.a.trackEvent(null,{id:5309,action:"Click"}))},e.insertEmoji=function(t){var n,r=e.props,a=r.inputMessage,c=r.senderId,o=r.inputValue,i=e.state.cursorPosition,s=[o.slice(0,i),t,o.slice(i)].join("");e.setState({cursorPosition:i+t.length}),a({senderId:c,inputValue:s}),me.a.trackEvent(null,{id:3641,action:"Click",name:t.slice(1,t.length-1)}),null===(n=e.inputRef.current)||void 0===n||n.focus()},e.handleBlur=function(t){e.setState({cursorPosition:t.target.selectionStart})},e.handleInputMessage=function(t){var n=e.props;(0,n.inputMessage)({senderId:n.senderId,inputValue:t.target.value})},e.handleInputRef=function(t){e.inputRef.current=t},e}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.inputRef.current&&(this.inputRef.current.focus(),this.inputRef.current.addEventListener("keydown",this.handleKeyDown))}},{key:"componentWillUnmount",value:function(){this.inputRef.current&&this.inputRef.current.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.props,t=e.inputValue,n=e.senderId,r=e.sender;return(null==r?void 0:r.isForbidden)?Object(s.b)("div",{className:"InputBox",css:{justifyContent:"flex-end"},children:Object(s.b)("div",{className:"InputBox-footer",children:Object(s.c)("div",{className:"InputBox-footerDesc",css:{textAlign:"center",paddingRight:0},children:["要反馈",Object(s.b)(xt.Link,{to:"/messages/3d198a56310c02c4a83efb9f4a4c027e",css:function(e){return{color:e.colors.GBK06A,fontWeight:"bold",paddingLeft:"4px"}},children:"@知乎小管家"})]})})}):Object(s.c)("div",{className:"InputBox",children:[Object(s.b)(dn,{endSignal:this.state.firstInteractive}),Object(s.b)(sn,{senderId:n,insertEmoji:this.insertEmoji,handleSendImage:this.handleSendImage,handleSendEmoticon:this.handleSendEmoticon,onHandleFirstInterActive:this.handleSetFirsetInteractive}),Object(s.b)(wt.a,{multiline:!0,spread:!0,value:t,className:"InputBox-input",onRef:this.handleInputRef,onChange:this.handleInputMessage,onBlur:this.handleBlur}),Object(s.c)("div",{className:"InputBox-footer",children:[Object(s.b)("div",{className:"InputBox-footerDesc",children:"按 Enter 键发送"}),Object(s.b)(h.c,{preset:"primary",color:"blue",className:"InputBox-sendBtn",onClick:this.handleSendTextMessage,disabled:!t.trim(),children:"发送"})]})]})}}]),n}(l.Component);var hn=Object(w.compose)(xt.withRouter,Object(m.connect)((function(e,t){var n=t.senderId,r=(e.chat.chats[n]||{}).inputValue;return{inputValue:void 0===r?"":r}}),{sendMessage:g.o,inputMessage:g.l,uploadImage:K.b,addTempImageMessage:g.b,setImageSendFailure:g.p,showNotification:de.g}))(fn);function bn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var mn=function(e){Object(c.a)(n,e);var t=bn(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={isAlertShow:!0},e.handleCloseAlert=function(){e.setState({isAlertShow:!1})},e}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.message,n=e.className;return this.state.isAlertShow?Object(s.c)("div",{className:C()("AbnormalAlert",n),children:[Object(s.b)("span",{className:"AbnormalAlert-message",dangerouslySetInnerHTML:{__html:t}}),Object(s.b)(b.a,{className:"AbnormalAlert-icon",onClick:this.handleCloseAlert})]}):null}}]),n}(l.Component);mn.propsTypes={message:p.a.object,className:p.a.string};var vn=n(225),gn=Object.assign;var On=function(e){return u.a.createElement(Wt.a,gn({width:"200",height:"88",fill:"none",viewBox:"0 0 200 88"},e),u.a.createElement("path",{fill:"#E3EAF1",d:"M90.78 11.188H52.292v66.743h9.43l1.259 8.04 12.754-8.04H90.78V11.189zM74.51 69.597l-7.488 4.713-.734-4.713h-5.389V19.47h21.186v50.126H74.51zM45.189 41.222H31.193c0-1.473.105-2.98.123-4.557V19.477H47.27v-4.054a4.224 4.224 0 00-1.262-2.99 4.307 4.307 0 00-3.024-1.238H18.072c.088-.277.175-.555.262-.797C19.192 7.834 21.938.002 21.938.002a13.32 13.32 0 00-7.54 2.183c-1.784 1.248-2.851 2.131-4.286 6.082-1.662 4.54-3.114 8.923-4.094 11.54C4.514 23.981.875 31.328.875 31.328a18.295 18.295 0 007.872-1.906c3.5-1.854 5.249-4.696 6.421-9.01l.28-.936h7.295v17.188c0 1.56-.14 3.067-.227 4.557H9.64a8.404 8.404 0 00-5.914 2.426 8.242 8.242 0 00-2.449 5.856h20.399a55.358 55.358 0 01-2.432 11.401 52.49 52.49 0 01-9.412 16.478A103.517 103.517 0 010 86.687s9.78 3.674 16.952-2.98c4.34-4.037 8.223-11.92 10.095-17.898a87.786 87.786 0 003.499-16.34h18.65v-4.28a3.918 3.918 0 00-1.169-2.81 4.022 4.022 0 00-2.838-1.157z"}),u.a.createElement("path",{fill:"#E3EAF1",d:"M35.222 58.361l-7.226 4.661 15.746 23.305a21.572 21.572 0 002.099-6.931 9.843 9.843 0 00-.875-6.775l-9.744-14.26zm125.555-14.01v-29.23a7322.86 7322.86 0 0029.496-1.507l2.659-.156c1.207-1.248 2.764-7.485 2.152-9.443-.228-.78-.665-2.08-1.995-1.733a103.979 103.979 0 01-13.366 2.27c-8.642 1.005-12.403 1.265-24.387 2.131-20.994 1.525-39.713 2.253-39.713 2.253a7.857 7.857 0 00.64 3.114 7.923 7.923 0 001.823 2.617 8.012 8.012 0 002.713 1.697 8.085 8.085 0 003.169.507c7.12-.294 17.494-.78 28.114-1.282v28.762h-39.941c0 2.197.881 4.303 2.449 5.857a8.406 8.406 0 005.914 2.425h31.578v22.11c0 2.772-1.452 3.725-3.849 3.794h-12.247a12.979 12.979 0 002.613 4.826 13.117 13.117 0 004.385 3.335 19.423 19.423 0 008.468.866c4.251-.208 9.272-2.581 9.272-11.158V52.633h35.252c1.067 0 2.091-.42 2.845-1.167A3.965 3.965 0 00200 48.648v-4.297h-39.223z"}),u.a.createElement("path",{fill:"#E3EAF1",d:"M133.169 24.611a7.192 7.192 0 00-2.065-1.914 7.273 7.273 0 00-5.476-.882 7.26 7.26 0 00-2.571 1.167l-1.172.85 13.296 18.279 6.998-5.06-9.01-12.44zm46.048-.617L169.455 36.8l6.997 5.198 14.119-18.522-1.172-.867a7.294 7.294 0 00-8.066-.49 7.196 7.196 0 00-2.116 1.876z"}))};function jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var yn=function(e){Object(c.a)(n,e);var t=jn(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.senderId,n=e.getEcomProfile;(0,e.getAccountInfo)(),t&&n(t)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.senderId,r=e.sender,a=e.warning,c=a.status,o=a.message,i=r||{},l=i.name,u=void 0===l?"":l,d=i.vipInfo,p=((void 0===d?{}:d)||{}).vipIcon;return n?Object(s.c)("div",{className:C()("ChatBox",t),children:[c&&Object(s.b)(mn,{message:o,className:"ChatBox-alert"}),Object(s.c)("header",{className:"ChatBox-title",children:[Object(s.b)("span",{children:u}),p&&Object(s.b)("img",{src:p.url,className:"ChatBox-titleVipIcon"})]}),Object(s.b)("div",{className:"MessagesBox-wrapper",children:Object(s.b)(Mt,{senderId:n})}),Object(s.b)(hn,{senderId:n,sender:r})]}):Object(s.b)("div",{className:"ChatBox-empty",children:Object(s.b)(On,{className:"ChatBox-emptyImage"})})}}]),n}(l.Component);yn.propTypes={senderId:p.a.string,className:p.a.string};var Mn=Object(m.connect)((function(e,t){var n=t.senderId,r=e.chat.chats[n]||{},a=r.receiver,c=void 0===a?{}:a,o=r.sender,i=void 0===o?{}:o,s=r.warning;return{receiver:c,sender:i,warning:void 0===s?{}:s}}),{getAccountInfo:vn.b,getEcomProfile:g.i})(yn);function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var kn=function(e){Object(c.a)(n,e);var t=xn(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.memberHashId,n=e.isModalShow,r=e.handleCloseModal;return Object(s.b)(f.b,{className:"ChatBoxModal",spread:!0,onClose:r,contentClassName:"ChatBoxModal-content",closeButton:Object(s.b)(h.c,{preset:"plain",className:"ChatBoxModal-closeButton",onClick:r,"aria-label":"关闭",children:Object(s.b)(b.a,{className:"ChatBoxModal-closeIcon"})}),children:n&&Object(s.b)(x,{handleReceiveMessage:this.handleReceiveMessage,children:Object(s.b)(Mn,{type:"default",senderId:t,className:"Chat-ChatBox"},t)})})}}]),n}(l.Component);kn.propTypes={memberHashId:p.a.string,handleCloseModal:p.a.func,isModalShow:p.a.bool}},1336:function(e,t,n){"use strict";var r=n(1),a=n.n(r),c=n(17),o=function(e){return a.a.createElement(c.a,e,a.a.createElement("path",{d:"M9.676 11.252c-.243.433-.542.85-.494 1.237.189 1.509 2.938 1.807 3.746 2.816.59.736.835 1.852.892 3.725.01.303 0 .97-.867.97H1.933c-.915 0-.925-.643-.915-.936.062-1.877.292-3.02.895-3.76.812-.994 3.743-1.267 3.872-2.872.03-.361-.246-.74-.493-1.18C3.917 8.802 3.39 4 7.466 4s3.506 4.941 2.21 7.252zm8.073.79l.002.641c1.57 1.766 4.47 1.307 4.851 3.166.125.61.328 1.538.384 3.232.009.284.014.919-.905.919-.92 0-5.523-.021-6.875-.019 0-2.806-.144-5.987-2.707-6.285.537-.331 1.725-.504 2.178-1.013l.002-.64c-.881.118-2.679-.541-2.679-.541.61-.64.747-1.387 1.192-4.317.355-2.93 2.835-2.903 3.022-2.903.187 0 2.667-.027 3.028 2.903.439 2.93.577 3.677 1.186 4.317 0 0-1.797.659-2.68.54z",fillRule:"evenodd"}))};o.defaultProps={name:"Users"},t.a=o},1382:function(e,t,n){"use strict";n.r(t);var r=n(32),a=n(7),c=n(8),o=n(9),i=n(10),s=n(5),l=n(0),u=n(2),d=n.n(u),p=n(1),f=n.n(p),h=n(13),b=n(46),m=n(18),v=n(12),g=n(17),O=function(e){return f.a.createElement(g.a,e,f.a.createElement("path",{d:"M17 6.998h3.018c1.098 0 1.975.89 1.982 2.002v10a1.993 1.993 0 0 1-1.987 2H3.98A1.983 1.983 0 0 1 2 19l.009-10.003c0-1.11.873-1.999 1.971-1.999L7 7V5c.016-1.111.822-2 2-2h6c.98 0 1.86.889 2 2v1.998zM9 7h6V5.5s0-.5-.5-.5h-5c-.504 0-.5.5-.5.5V7z",fillRule:"evenodd"}))};O.defaultProps={name:"Company"};var j=O,y=n(1336),M=n(166),x=n.n(M),k=n(393),C=n(238),w=n(71),R=n(226),E=n(309),S=n(1139),T=n(649),I=n(6),N=n.n(I),B=function(e){return f.a.createElement(S.a,Object.assign({},e,{className:N()("KfeCollection-VipIcon",e.className),onClick:function(){var t;Object(T.a)("https://www.zhihu.com/xen/market/vip-privileges",{}),null==e||null===(t=e.onClick)||void 0===t||t.call(e)}}))},z=n(267),D=n(11),A=n(1118),P=n(268),U=n(181),_=n(52),H=n(1083),L=n(33),K=n(1215),F=n(28);function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(i.a)(this,n)}}var V=function(e){Object(o.a)(n,e);var t=q(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={modalShown:!1},e.handleSendMessage=function(){var t=e.props,n=t.onModalOpen,r=t.user.allowMessage,a=t.dispatch,c=t.doNotCheckAllowMessageSetting;r||void 0===r&&c?(e.setState({modalShown:!0}),n&&n()):a(Object(L.g)(F.H.blocked,"red")),v.a.trackEvent(Object(_.a)(e),{action:"Message",element:"Button",is_intent:!0})},e.handleCloseModal=function(){var t=e.props.onModalClose;e.setState({modalShown:!1}),t&&t()},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.user,n=e.preset,r=e.color,a=e.icon,c=e.label,o=e.className,i=e.tooltip,s=e.tooltipPreset,u=this.state.modalShown,d="3d198a56310c02c4a83efb9f4a4c027e"===t.id;return Object(l.c)(l.a,{children:[Object(l.b)(D.c,{preset:n,color:r,className:o,icon:a,label:c,onClick:this.context.authRequired(this.handleSendMessage,d?F.J.serviceAccountMessage:F.J.message),"data-tooltip":i,"data-tooltip-preset":s}),Object(l.b)(K.a,{memberHashId:t.id,handleCloseModal:this.handleCloseModal,isModalShow:u})]})}}]),n}(p.Component);V.propTypes={onModalOpen:d.a.func,onModalClose:d.a.func},V.defaultProps={preset:"outline",color:"grey",icon:H.a,label:"发私信",doNotCheckAllowMessageSetting:!1},V.contextTypes={authRequired:d.a.func};var G=Object(h.connect)()(V),W=n(120);function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(i.a)(this,n)}}var Q=function(e){Object(o.a)(n,e);var t=J(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={reportModalShown:!1},e.handleShieldUser=function(){var t=e.props,n=t.user.urlToken,r=t.updateUserBlocking,a=t.showNotification;r(n,!1).then((function(){return a("屏蔽已取消")}))},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.user,r=t.user,a=r.urlToken,c=r.isBlocking,o=r.isOrg,i=t.className,s=t.buttonClassName,u=t.onModalOpen,d=t.onModalClose,p=this.context.authRequired,f=this.state.reportModalShown,h=N()("MemberButtonGroup",i);return c?Object(l.c)("div",{className:h,children:[Object(l.c)(D.c,{className:s,preset:"primary",color:"red",onClick:this.handleShieldUser,children:[Object(l.b)(A.a,{center:!0,text:!0})," 已屏蔽"]}),!o&&Object(l.c)(D.c,{className:s,onClick:p((function(){e.setState({reportModalShown:!0}),u&&u()}),F.J.report),children:["举报用户",Object(l.b)(U.a,{shown:f,onClose:function(){e.setState({reportModalShown:!1}),d&&d()},type:"member",urlToken:a,zaEnabled:!0})]})]}):Object(l.c)("div",{className:h,children:[Object(l.b)(P.a,{id:a,type:n.type,gender:n.gender,isFollowing:n.isFollowing,className:s,preset:P.a.PRESETS.primary}),Object(l.b)(G,{user:n,className:s,onModalOpen:u,onModalClose:d})]})}}]),n}(p.Component);Q.contextTypes={authRequired:d.a.func},Q.propTypes={user:d.a.object.isRequired,buttonClassName:d.a.string,onModalOpen:d.a.func,onModalClose:d.a.func};var Z=Object(h.connect)(null,{updateUserBlocking:W.h,showNotification:L.g})(Q);function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(i.a)(this,n)}}var $=function(e){Object(o.a)(n,e);var t=X(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.user,r=t.user.isOrg,a=t.className,c=t.buttonClassName,o=t.onModalOpen,i=t.onModalClose,s=this.context,u=s.currentUser,d=s.authRequired,p=s.router,f=N()("ProfileButtonGroup",a);return u&&n.urlToken===u.urlToken?Object(l.b)("div",{className:f,children:Object(l.c)(D.c,{color:"blue",className:c,onClick:d((function(){v.a.trackEvent(e,{action:"OpenUrl",element:"Link"},{link:{url:"".concat(location.origin,"/people/edit")}}),p.push("/people/edit")}),F.J.editProfile),children:["编辑",r?"机构":"个人","资料"]})}):Object(l.b)(Z,{user:n,className:f,buttonClassName:c,onModalOpen:o,onModalClose:i})}}]),n}(p.Component);$.contextTypes={router:d.a.object.isRequired,currentUser:d.a.object,authRequired:d.a.func},$.propTypes={user:d.a.object.isRequired,buttonClassName:d.a.string,onModalOpen:d.a.func,onModalClose:d.a.func};var Y=$,ee=n(110),te=n(658),ne=n(659);function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(i.a)(this,n)}}var ae=function(e,t){return e.map((function(e){return t[e]})).slice(0,3)},ce=Object(w.isBrowser)()?x()(ae,(function(e,t){return"".concat(e.join(","),"-").concat(t.length)})):ae,oe=[];var ie=function(e){return Object(l.b)(m.Flex,Object.assign({css:{"&:not(:last-child)":{marginBottom:8}}},e))},se=function(e){Object(o.a)(n,e);var t=re(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={isLoading:!1,childModalOpened:!1},e.loadUserProfile=function(){var t=e.props,n=t.id,r=t.urlToken;return(0,t.dispatch)(Object(W.g)(r||n,!1))},e.load=function(){var t=e.props,n=t.id;(t.urlToken||n)&&(e.setState({isLoading:!0}),e.loadUserProfile().then((function(){return e.setState({isLoading:!1})})),e.loadMutuals())},e.loadMutuals=function(){var t=e.props,n=t.user,r=t.dispatch,a=t.mutuals;return!(void 0===a?[]:a).length&&e.context.currentUser&&n?r(Object(W.e)(n.urlToken,"mutuals")):Promise.resolve()},e.track=function(){var t=e.props.user;e.hoverCardElement&&t&&(v.a.setModule(e.hoverCardElement,{module:"UserItem"},{card:{content:{type:"User",member_hash_id:t.id}}}),v.a.trackCardShow(e.hoverCardElement))},e.handleOpen=function(){e.load(),e.track()},e}return Object(c.a)(n,[{key:"render",value:function(){var e,t,n=this,a=this.props,c=a.toggler,o=a.user,i=a.id,s=a.urlToken,u=a.mutuals,d=void 0===u?[]:u,p=a.onRef,f=Object(r.a)(a,["toggler","user","id","urlToken","mutuals","onRef"]),h=o||{},v=h.isOrg,g=h.name,O=h.headline,M=h.avatarUrl,x=h.badge,w=h.badgeV2,S=h.answerCount,T=h.articlesCount,I=h.followerCount,N=h.employments,D=h.coverUrl,A=h.gender,P=h.isFollowed,U=h.isFollowing,_=h.vipInfo,H=((void 0===_?{}:_)||{}).isVip,L=this.state,K=L.isLoading,q=L.childModalOpened,V=d.length,G=Object(C.d)(w||x),W=G.bestAnswerer,J=G.identity,Q="//www.zhihu.com/".concat(v?"org":"people","/").concat(s||i),Z=this.context.currentUser,X=Z&&o&&Z.urlToken===o.urlToken,$=V>0&&!X,re=N&&N[0];if(null==J?void 0:J.length)t=Object(l.c)(ie,{children:[Object(l.b)("a",{href:"".concat(F.v,"/account/verification/intro"),target:"_blank",rel:"noopener noreferrer",css:{marginRight:".3em"},children:Object(l.b)(C.a,{})}),Object(l.b)("div",{children:J.slice(0,2).map((function(e){return e.description})).join("，")})]});else if(re){var ae=re.company,ce=re.job;t=Object(l.c)(ie,{children:[(ae||ce)&&Object(l.b)(m.Box,{as:"span",mr:".3em",color:"GBL05A",children:Object(l.b)(j,{text:!0,center:!0})}),Object(l.c)("div",{children:[ae&&ae.name,ae&&ce&&Object(l.b)(m.Box,{display:"inline-block",width:"1px",height:"10px",mx:"8px",bg:"GBK09A"}),ce&&ce.name]})]})}else t=null;return Object(l.c)(E.b,Object.assign({toggler:c,onOpen:this.handleOpen,isLoading:K,globalClose:!q,stickHover:q,preventCloseOnTarget:!0},f,{onRef:function(e){p&&"function"==typeof p&&p(e),n.hoverCardElement=e},children:[Object(l.b)(E.a,{coverUrl:D,title:Object(l.c)("span",{css:{display:"flex"},children:[Object(l.c)(b.Link,{to:Q,target:"_blank",css:{display:"flex",alignItems:"center"},children:[g,H&&Object(l.b)(B,{css:{width:"18px",height:"18px",marginLeft:"5px"}})]}),Object(l.b)(ne.a,{isFollowed:P,isFollowing:U})]}),subtitle:O&&Object(l.b)(z.a,{inline:!0,html:O}),avatarUrl:M}),(t||W||$)&&Object(l.c)("div",{children:[t,Boolean(null==W||null===(e=W.topics)||void 0===e?void 0:e.length)&&Object(l.c)(ie,{children:[Object(l.b)("span",{css:{marginRight:".3em"},children:Object(l.b)(C.b,{})}),Object(l.c)("div",{children:[Object(l.b)(te.a,{expandable:!1,noHoverCard:!0,topics:W.topics,user:o}),"的优秀答主"]})]}),$&&Object(l.c)(ie,{color:"GBL05A",children:[Object(l.b)(m.Box,{mr:".3em",children:Object(l.b)(y.a,{text:!0,center:!0})}),Object(l.b)("div",{children:Object(l.c)(k.CJKSpace,{children:[d.map((function(e,t){return Object(l.c)(b.Link,{to:"//www.zhihu.com/".concat(v?"org":"people","/").concat(e.urlToken),target:"_blank",children:[e.name,t<V-1&&"、"]},t)})),"也关注了",F.C[A]]})})]})]}),Object(l.c)("div",{children:[Object(l.c)(R.a,{children:[Object(l.b)(R.a.Item,{tag:ee.a,preset:"plain",to:"".concat(Q,"/answers"),name:"回答",value:S,target:"_blank"}),Object(l.b)(R.a.Item,{tag:ee.a,preset:"plain",to:"".concat(Q,"/posts"),name:"文章",value:T,target:"_blank"}),Object(l.b)(R.a.Item,{tag:ee.a,preset:"plain",to:"".concat(Q,"/followers"),name:"关注者",value:I,target:"_blank"})]}),o&&!X&&Object(l.b)(Y,{className:"HoverCard-buttons",user:o,onModalOpen:function(){n.hoverCardElement.style.opacity="0",n.setState({childModalOpened:!0})},onModalClose:function(){return n.setState({childModalOpened:!1})}})]})]}))}}]),n}(p.PureComponent);se.contextTypes={currentUser:d.a.object};t.default=Object(h.connect)((function(e,t){var n=t.id,r=t.urlToken,a=e.entities,c=e.people.mutualsByUser,o=a.users[r]||Object.values(a.users).find((function(e){return e.id===n}))||t.user,i=c[r||n]||{ids:oe,isFetching:!1},s=i.ids,l=i.isFetching;return{user:o,mutuals:ce(s,a.users),isFetching:l}}))(se)}}]);
//# sourceMappingURL=column.user-hover-card.bf391d4299c3cec21e67.js.map